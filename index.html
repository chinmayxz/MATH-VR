<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Math Trivia</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- VRButton library -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/webxr/VRButton.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/webxr-polyfill@latest/build/webxr-polyfill.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        #startScreen, #categoryScreen, #gameScreen, #resultsScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 20, 40, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            pointer-events: all;
            box-shadow: 0 10px 50px rgba(0, 255, 255, 0.3);
            border: 2px solid rgba(0, 255, 255, 0.5);
            max-width: 600px;
        }
        h1 {
            color: #00ffff;
            margin: 0 0 20px 0;
            font-size: 2.5em;
            text-shadow: 0 0 10px #00ffff;
        }
        h2 {
            color: #00ddff;
            margin: 0 0 20px 0;
            font-size: 1.8em;
        }
        button {
            background: linear-gradient(135deg, #0066cc, #00ccff);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 200, 255, 0.4);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 200, 255, 0.6);
        }
        button:active {
            transform: translateY(0);
        }
        .category-btn {
            display: block;
            width: 100%;
            margin: 15px 0;
        }
        #question {
            color: #ffffff;
            font-size: 1.4em;
            margin: 20px 0;
            line-height: 1.5;
        }
        .answer-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 15px 20px;
            margin: 10px 0;
            background: linear-gradient(135deg, #1a5080, #2a7090);
        }
        .answer-btn.correct {
            background: linear-gradient(135deg, #00aa00, #00ff00);
        }
        .answer-btn.incorrect {
            background: linear-gradient(135deg, #aa0000, #ff0000);
        }
        #score {
            color: #ffff00;
            font-size: 1.3em;
            margin: 10px 0;
            text-shadow: 0 0 5px #ffff00;
        }
        #progress {
            color: #aaddff;
            font-size: 1.1em;
            margin: 10px 0;
        }
        .hidden {
            display: none;
        }
        p {
            color: #aaddff;
            font-size: 1.1em;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div id="startScreen">
            <h1>üåä VR Math Trivia üåä</h1>
            <p>Test your math knowledge in a stunning waterfall environment!</p>
            <button onclick="showCategories()">Start Game</button>
        </div>

        <div id="categoryScreen" class="hidden">
            <h2>Choose Your Category</h2>
            <button class="category-btn" onclick="startGame('geometry')">üìê Geometry</button>
            <button class="category-btn" onclick="startGame('algebra')">üî¢ Algebra</button>
            <button class="category-btn" onclick="startGame('calculus')">üìä Calculus</button>
        </div>

        <div id="gameScreen" class="hidden">
            <div id="score">Score: 0</div>
            <div id="progress">Question 1/10</div>
            <div id="question"></div>
            <div id="answers"></div>
        </div>

        <div id="resultsScreen" class="hidden">
            <h1>Round Complete! üéâ</h1>
            <div id="finalScore"></div>
            <button onclick="showCategories()">Play Again</button>
            <button onclick="location.reload()">Main Menu</button>
        </div>
    </div>

    <script>
        let scene, camera, renderer;
        let score = 0;
        let currentQuestion = 0;
        let attempted = false;
        let currentCategory = '';

        const questions = { /* same questions here (unchanged) */ };

        function initScene() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87ceeb);
            scene.fog = new THREE.Fog(0x87ceeb, 50, 200);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 30);
            camera.lookAt(0, 5, 0);

            renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize(window.innerWidth, window.innerHeight);

            // ‚úÖ Enable WebXR
            renderer.xr.enabled = true;

            document.body.appendChild(renderer.domElement);

            // ‚úÖ Add Enter VR button
            document.body.appendChild(THREE.VRButton.createButton(renderer));

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 50, 50);
            scene.add(directionalLight);

            // Water pool
            const poolGeometry = new THREE.CylinderGeometry(25, 25, 1, 32);
            const poolMaterial = new THREE.MeshPhongMaterial({
                color: 0x1e90ff,
                transparent: true,
                opacity: 0.7,
                shininess: 100
            });
            const pool = new THREE.Mesh(poolGeometry, poolMaterial);
            pool.position.y = 0;
            scene.add(pool);

            // Cliffs
            for (let i = 0; i < 3; i++) {
                const cliffGeometry = new THREE.BoxGeometry(15, 40, 15);
                const cliffMaterial = new THREE.MeshPhongMaterial({color: 0x808080});
                const cliff = new THREE.Mesh(cliffGeometry, cliffMaterial);
                cliff.position.set(
                    Math.cos(i * Math.PI * 2 / 3) * 30,
                    20,
                    Math.sin(i * Math.PI * 2 / 3) * 30
                );
                scene.add(cliff);
            }

            // Waterfall particles
            const particleCount = 1000;
            const particles = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            
            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 60;
                positions[i + 1] = Math.random() * 50 + 10;
                positions[i + 2] = (Math.random() - 0.5) * 60;
            }
            
            particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            const particleMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.3,
                transparent: true,
                opacity: 0.8
            });
            
            const particleSystem = new THREE.Points(particles, particleMaterial);
            scene.add(particleSystem);

            // Trees
            for (let i = 0; i < 15; i++) {
                const trunkGeometry = new THREE.CylinderGeometry(0.5, 0.7, 8, 8);
                const trunkMaterial = new THREE.MeshPhongMaterial({color: 0x8b4513});
                const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                
                const leavesGeometry = new THREE.SphereGeometry(3, 8, 8);
                const leavesMaterial = new THREE.MeshPhongMaterial({color: 0x228b22});
                const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
                leaves.position.y = 6;
                
                trunk.add(leaves);
                
                const angle = (i / 15) * Math.PI * 2;
                const radius = 35 + Math.random() * 10;
                trunk.position.set(
                    Math.cos(angle) * radius,
                    4,
                    Math.sin(angle) * radius
                );
                
                scene.add(trunk);
            }

            renderer.setAnimationLoop(() => animate()); // ‚úÖ Required for VR
        }

        function animate() {
            const particles = scene.children.find(child => child instanceof THREE.Points);
            if (particles) {
                const positions = particles.geometry.attributes.position.array;
                for (let i = 1; i < positions.length; i += 3) {
                    positions[i] -= 0.3;
                    if (positions[i] < 0) {
                        positions[i] = 60;
                    }
                }
                particles.geometry.attributes.position.needsUpdate = true;
            }
            camera.position.x = Math.sin(Date.now() * 0.0001) * 5;
            camera.lookAt(0, 5, 0);
            renderer.render(scene, camera);
        }

        // --- Game logic stays same (showCategories, startGame, loadQuestion, etc.) ---

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        initScene();
    </script>
</body>
</html>
