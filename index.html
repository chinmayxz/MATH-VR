<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VR Math Trivia</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
  body { margin:0; overflow:hidden; font-family:Arial; }
  #ui { position:absolute; top:0; left:0; width:100%; height:100%; z-index:10; pointer-events:auto; }
  .screen { 
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      background: rgba(0,20,40,0.95); padding:30px; border-radius:20px; text-align:center;
      pointer-events:all; color:#fff;
  }
  .hidden { display:none; }
  button {
      background: linear-gradient(135deg,#0066cc,#00ccff);
      color:white; border:none; padding:12px 25px; margin:8px; border-radius:10px;
      cursor:pointer; font-size:1em;
  }
  #vrButton { position:absolute; top:20px; right:20px; z-index:100; }
</style>
</head>
<body>

<div id="ui">
  <div id="startScreen" class="screen">
      <h1>ðŸŒŠ VR Math Trivia</h1>
      <button onclick="showCategories()">Start Game</button>
  </div>

  <div id="categoryScreen" class="screen hidden">
      <h2>Choose Your Category</h2>
      <button onclick="startGame('geometry')">Geometry</button>
      <button onclick="startGame('algebra')">Algebra</button>
      <button onclick="startGame('calculus')">Calculus</button>
  </div>

  <div id="gameScreen" class="screen hidden">
      <div id="score">Score: 0</div>
      <div id="progress">Question 1/10</div>
      <div id="question"></div>
      <div id="answers"></div>
  </div>

  <div id="resultsScreen" class="screen hidden">
      <h1>Round Complete!</h1>
      <div id="finalScore"></div>
      <button onclick="showCategories()">Play Again</button>
      <button onclick="location.reload()">Main Menu</button>
  </div>

  <button id="vrButton" onclick="toggleVR()">Enter VR</button>
</div>

<script>
let scene, camera, renderer;
let isVRMode=false;

// ------------------ Init Scene ------------------
function initScene(){
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87ceeb);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0,5,20);

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;  // Enable WebXR
    document.body.appendChild(renderer.domElement);

    // Basic lighting
    scene.add(new THREE.AmbientLight(0xffffff,0.6));
    let dirLight = new THREE.DirectionalLight(0xffffff,0.8);
    dirLight.position.set(50,50,50);
    scene.add(dirLight);

    // Simple environment
    let geometry = new THREE.SphereGeometry(200,60,40);
    geometry.scale(-1,1,1);
    let texture = new THREE.TextureLoader().load('https://cdn.pixabay.com/photo/2013/07/12/16/54/sky-151994_1280.jpg');
    scene.add(new THREE.Mesh(geometry,new THREE.MeshBasicMaterial({map:texture})));

    animate();
}

// ------------------ Animate Loop ------------------
function animate(){
    renderer.setAnimationLoop(()=>{
        renderer.render(scene,camera);
    });
}

// ------------------ VR Toggle ------------------
function toggleVR(){
    const btn = document.getElementById('vrButton');
    isVRMode = !isVRMode;
    if(isVRMode){
        btn.textContent='Exit VR';
        navigator.xr.requestSession('immersive-vr',{optionalFeatures:['local-floor']})
            .then(session => renderer.xr.setSession(session));
    } else {
        btn.textContent='Enter VR';
        renderer.xr.getSession()?.end();
    }
}

// ------------------ Quiz Logic ------------------
let score=0, currentQ=0, currentCategory='';
const questions={
    geometry:[
        {q:"Sum of angles in triangle?", a:["180","360","90","270"], c:0},
        {q:"Hexagon sides?", a:["5","6","7","8"], c:1}
    ],
    algebra:[
        {q:"2x+5=15, solve x?", a:["5","10","7.5","20"], c:0}
    ],
    calculus:[
        {q:"Derivative of xÂ²?", a:["x","2x","xÂ²","2"], c:1}
    ]
};

function showCategories(){
    hideAllScreens();
    document.getElementById('categoryScreen').classList.remove('hidden');
}

function startGame(cat){
    currentCategory=cat; score=0; currentQ=0;
    hideAllScreens();
    document.getElementById('gameScreen').classList.remove('hidden');
    loadQuestion();
}

function loadQuestion(){
    const qlist = questions[currentCategory];
    if(currentQ >= qlist.length){
        showResults();
        return;
    }
    const q = qlist[currentQ];
    document.getElementById('question').textContent = q.q;
    document.getElementById('score').textContent = `Score: ${score}`;
    const answersDiv = document.getElementById('answers');
    answersDiv.innerHTML='';
    q.a.forEach((ans,i)=>{
        const btn = document.createElement('button');
        btn.textContent = ans;
        btn.onclick = ()=>checkAnswer(i,q.c,btn);
        answersDiv.appendChild(btn);
    });
}

function checkAnswer(sel,correct,btn){
    if(sel===correct){ btn.style.background='green'; score+=10; }
    else{ btn.style.background='red'; }
    currentQ++;
    setTimeout(loadQuestion,800);
}

function showResults(){
    hideAllScreens();
    document.getElementById('resultsScreen').classList.remove('hidden');
    document.getElementById('finalScore').textContent=`Score: ${score}`;
}

function hideAllScreens(){
    document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));
}

// ------------------ Resize ------------------
window.addEventListener('resize',()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
});

initScene();
</script>
</body>
</html>
