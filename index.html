<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VR Math Trivia</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/renderers/CSS3DRenderer.js"></script>
<style>
    body { margin: 0; overflow: hidden; font-family: Arial; }
    #ui { pointer-events: auto; z-index: 10; }
    #startScreen, #categoryScreen, #gameScreen, #resultsScreen {
        background: rgba(0,20,40,0.95);
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        pointer-events: all;
        box-shadow: 0 10px 50px rgba(0,255,255,0.3);
        border: 2px solid rgba(0,255,255,0.5);
        max-width: 600px;
    }
    h1 { color: #0ff; margin-bottom: 20px; }
    h2 { color: #0dd; margin-bottom: 20px; }
    button {
        background: linear-gradient(135deg,#0066cc,#00ccff);
        color:white; border:none; padding:15px 30px;
        margin:10px; font-size:1.1em; border-radius:10px;
        cursor:pointer; box-shadow: 0 4px 15px rgba(0,200,255,0.4);
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,200,255,0.6);}
    button:active { transform: translateY(0);}
    .hidden { display:none; }
    #vrButton {
        position: absolute; top:20px; right:20px; z-index:100;
        background: linear-gradient(135deg,#8a2be2,#9370db);
    }
    #vrButton.vr-active { background: linear-gradient(135deg,#ff4500,#ff6347);}
</style>
</head>
<body>
<div id="ui">
    <div id="startScreen">
        <h1>ğŸŒŠ VR Math Trivia ğŸŒŠ</h1>
        <p>Test your math knowledge in a stunning waterfall environment!</p>
        <button onclick="showCategories()">Start Game</button>
    </div>

    <div id="categoryScreen" class="hidden">
        <h2>Choose Your Category</h2>
        <button class="category-btn" onclick="startGame('geometry')">ğŸ“ Geometry</button>
        <button class="category-btn" onclick="startGame('algebra')">ğŸ”¢ Algebra</button>
        <button class="category-btn" onclick="startGame('calculus')">ğŸ“Š Calculus</button>
    </div>

    <div id="gameScreen" class="hidden">
        <div id="score">Score: 0</div>
        <div id="progress">Question 1/10</div>
        <div id="question"></div>
        <div id="answers"></div>
    </div>

    <div id="resultsScreen" class="hidden">
        <h1>Round Complete! ğŸ‰</h1>
        <div id="finalScore"></div>
        <button onclick="showCategories()">Play Again</button>
        <button onclick="location.reload()">Main Menu</button>
    </div>

    <button id="vrButton" onclick="toggleVR()">Enter VR Mode</button>
</div>

<script>
let scene, camera, renderer, cssRenderer, cssScene;
let uiObject;
let isVRMode = false;

// Initialize scene
function initScene() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87ceeb);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0,10,30);
    
    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // CSS3DRenderer for UI in 3D VR
    cssRenderer = new THREE.CSS3DRenderer();
    cssRenderer.setSize(window.innerWidth, window.innerHeight);
    cssRenderer.domElement.style.position = 'absolute';
    cssRenderer.domElement.style.top = 0;
    document.body.appendChild(cssRenderer.domElement);

    cssScene = new THREE.Scene();

    // Make HTML UI float in 3D scene
    uiObject = new THREE.CSS3DObject(document.getElementById('ui'));
    uiObject.position.set(0,0,-2); // 2 units in front of camera
    cssScene.add(uiObject);

    const ambientLight = new THREE.AmbientLight(0xffffff,0.6);
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff,0.8);
    directionalLight.position.set(50,50,50);
    scene.add(directionalLight);

    create360Environment();

    animate();
}

// 360 background
function create360Environment(){
    const geometry = new THREE.SphereGeometry(500,60,40);
    geometry.scale(-1,1,1);
    const texture = new THREE.TextureLoader().load('https://cdn.pixabay.com/photo/2013/07/12/16/54/sky-151994_1280.jpg'); // simple sky image
    const material = new THREE.MeshBasicMaterial({map:texture});
    const skySphere = new THREE.Mesh(geometry, material);
    scene.add(skySphere);
}

// Toggle VR
function toggleVR(){
    isVRMode = !isVRMode;
    const vrButton = document.getElementById('vrButton');

    if(isVRMode){
        vrButton.textContent = 'Exit VR Mode';
        vrButton.classList.add('vr-active');
        navigator.xr.requestSession('immersive-vr',{optionalFeatures:['local-floor']})
            .then(session => renderer.xr.setSession(session));
    }else{
        vrButton.textContent = 'Enter VR Mode';
        vrButton.classList.remove('vr-active');
        renderer.xr.getSession()?.end();
    }
}

// Animate
function animate(){
    renderer.setAnimationLoop(()=>{
        renderer.render(scene,camera);
        cssRenderer.render(cssScene,camera);
    });
}

// Handle resize
window.addEventListener('resize',()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
    cssRenderer.setSize(window.innerWidth,window.innerHeight);
});

initScene();

// -------------------------
// Below: Your existing quiz logic
// -------------------------
let score = 0, currentQuestion=0, currentCategory='', attempted=false;

const questions = {
    geometry:[
        {q:"What is sum of angles in triangle?",a:["180","360","90","270"],c:0},
        {q:"Hexagon sides?",a:["5","6","7","8"],c:1}
    ],
    algebra:[
        {q:"Solve 2x+5=15",a:["5","10","7.5","20"],c:0}
    ],
    calculus:[
        {q:"Derivative of xÂ²?",a:["x","2x","xÂ²","2"],c:1}
    ]
};

function showCategories(){
    document.getElementById('startScreen').classList.add('hidden');
    document.getElementById('resultsScreen').classList.add('hidden');
    document.getElementById('categoryScreen').classList.remove('hidden');
}

function startGame(category){
    currentCategory = category;
    score=0; currentQuestion=0;
    document.getElementById('categoryScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');
    loadQuestion();
}

function loadQuestion(){
    const catQ = questions[currentCategory];
    if(!catQ) return;
    const q = catQ[Math.floor(Math.random()*catQ.length)];
    document.getElementById('question').textContent=q.q;
    document.getElementById('score').textContent=`Score: ${score}`;
    const answersDiv = document.getElementById('answers');
    answersDiv.innerHTML='';
    q.a.forEach((ans,i)=>{
        const btn=document.createElement('button');
        btn.textContent=ans;
        btn.onclick=()=>checkAnswer(i,q.c,btn);
        answersDiv.appendChild(btn);
    });
}

function checkAnswer(selected,correct,btn){
    if(selected===correct){ btn.style.background='green'; score+=10;}
    else{ btn.style.background='red'; }
}
</script>
</body>
</html>
